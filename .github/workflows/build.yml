name: DriftFX Build

on: [push]

jobs:
  build-linux:

    runs-on: ubuntu-latest

    steps:
    - name: Prepare
      run: sudo apt-get install -y mesa-common-dev libgl1-mesa-dev libglu1-mesa-dev
    - uses: actions/checkout@v1
    - name: Configure Build
      run: |
        mkdir build && cd build
        cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo -G "Unix Makefiles" ../native
    - name: Build
      run: |
        cd build
        cmake --build .

  build-macos:

    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v1
    - name: Configure Build
      run: |
        mkdir build && cd build
        cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo -G "Unix Makefiles" ../native
    - name: Build
      run: |
        cd build
        cmake --build .

  build-windows:
    
    runs-on: windows-latest

    steps:
    - name: List cmake generators
      run: cmake --help
    - uses: actions/checkout@v1
    - name: Configure Build (cmake)
      run: |
        mkdir build
        cd build
        cmake -G "Visual Studio 16 2019" ../native
    - name: Build
      run: |
        cd build
        cmake --build . --config RelWithDebInfo
        
  bulid-maven:
    needs: [build-linux, build-macos, build-windows]

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
    - name: Set up JDK 1.8
      uses: actions/setup-java@v1
      with:
        java-version: 1.8
        java-package: jdk+fx
    - name: Build with Maven
      run: mvn -B package --file pom.xml

